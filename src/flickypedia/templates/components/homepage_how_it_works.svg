<!--
  This renders the series of boxes that illustrate the Flickypedia flow:

  [Log in] -> [Get Flickr photos] -> [Check info] -> [Upload] -> [Thank you]

  We change the diagram slightly based on whether the user is already
  logged in.  For new users, the first step is "Log in".  For users who
  are already logged in, the first step is "Get Flickr photos".
 -->

<svg viewBox="0 0 490 140" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      rect.next_step {
        fill: currentColor;
      }
      
      rect.step {
        fill: rgb(var(--brown));
      }
      
      text a {
        fill: rgb(var(--cream));
        font-weight: bold;
      }

      path {
        fill: transparent;
        stroke-width: 1;
        stroke: currentColor;
        stroke-dasharray: 3 2;
      }

      polygon {
        stroke-linecap: round;
        stroke-linejoin: round;
        corner-radius: 2px;
        stroke: currentColor;
        fill: currentColor;
      }

      line {
        stroke: #222;
        stroke-width: 1.5;
        stroke-linecap: round;
      }

      text, tspan {
        fill: currentColor;
        stroke: none;
				font-size: 12px;
				text-anchor: middle;
				dominant-baseline: middle;
			}
    </style>

    <marker id="pointer" markerWidth="10" markerHeight="8"
    	refX="9.5" refY="5.1" orient="auto" markerUnits="userSpaceOnUse">
      <polyline points="1 1, 10 5, 1 7" />
    </marker>
  </defs>

  <!-- Log in -->
  <rect
    x="5" y="45" width="80" height="50"
    class="{% if current_user.is_anonymous %}next_step{% else %}step{% endif %}"
  />

  <svg x="5" y="45">
    {% if current_user.is_anonymous %}
      <text x="40" y="29">
        <a href="{{ url_for('oauth2_authorize_wikimedia') }}">Log in</a>
      </text>
    {% else %}
      <text x="40" y="25">
        Log in
      </text>
    {% endif %}

    <polygon points="140,52 145,59 140,57 135,59"/>
    <path d="M 40 50 C 40 90, 141 90, 140 58"/>
  </svg>

  <!-- Get Flickr photos -->
  <rect
    x="105" y="45" width="80" height="50"
    class="{% if current_user.is_anonymous %}step{% else %}next_step{% endif %}"
  />
  
  <svg x="105">
    <svg y="45">
      {% if current_user.is_anonymous %}
        <text x="40" y="25">
          <tspan x="40" dy="-6">Get Flickr</tspan>
          <tspan x="40" dy="1.3em">photos</tspan>
        </text>
      {% else %}
        <text x="40" y="28">
          <tspan x="40" dy="-6">
            <a href="{{ url_for('find_photos') }}">Get Flickr</a>
          </tspan>
          <tspan x="40" dy="1.3em">
            <a href="{{ url_for('find_photos') }}">photos</a>
          </tspan>
        </text>
      {% endif %}
    </svg>

    <path d="M 40 45 C 40 5, 140 5, 140 37"/>
    <polygon points="140,43 145,36 140,38 135,36"/>
  </svg>

  <!-- Check info -->
  <rect x="205" y="45" width="80" height="50" class="step"/>

  <svg x="205" y="45">
    <text x="40" y="25">Check info</text>

    <polygon points="140,52 145,59 140,57 135,59"/>
    <path d="M 40 50 C 40 90, 141 90, 140 58"/>
  </svg>

  <!-- Upload to Wikimedia -->
  <rect x="305" y="45" width="80" height="50" class="step"/>
  
  <svg x="305">
    <svg y="45">
      <text x="40" y="25">
        <tspan x="40" dy="-6">Upload to</tspan>
        <tspan x="40" dy="1.3em">Wikimedia</tspan>
      </text>
    </svg>

    <path d="M 40 45 C 40 5, 140 5, 140 37"/>
    <polygon points="140,43 145,36 140,38 135,36"/>
  </svg>

  <!-- Leave a thank you -->
  <rect x="405" y="45" width="80" height="50" class="step"/>
  
  <svg x="405" y="45">
    <text x="40" y="25">
      <tspan x="40" dy="-5">Leave a</tspan>
      <tspan x="40" dy="1.2em">thank you</tspan>
    </text>
  </svg>
</svg>