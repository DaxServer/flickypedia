{% extends "base.html" %}

{% block content %}
  {% include "components/header.html" %}

  At this Flickr URL:

  <form action="{{ url_for('find_photos') }}" method="post">
    {{ photo_url_form.hidden_tag() }}

    {% with messages = get_flashed_messages(category_filter=["flickr_url"]) %}
      {% if messages %}
        <ul class="flashes">
        {% for message in messages %}
          <li>{{ message | safe }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {{ photo_url_form.flickr_url(value=flickr_url) }}

    <p>{{ photo_url_form.submit() }}</p>
  </form>

  {% with messages = get_flashed_messages(category_filter=["select_photos"]) %}
    {% if messages %}
      <ul class="flashes">
      {% for message in messages %}
        <li>{{ message | safe }}</li>
      {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <style>
    #select_photos ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-column-gap: 1em;
      grid-row-gap: 1em;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }

    #select_photos li {
      display: inline-block;
    }

    #select_photos li img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
    }

    #select_photos li .info {
      display: grid;
    }

    #select_photos li label .owner {
      grid-row: 1 / 2;
      grid-column: 1 / 2;
    }

    #select_photos li label .license {
      grid-row: 2 / 2;
      grid-column: 1 / 2;
    }

    #select_photos li label input[type="checkbox"] {
      grid-row: 1 / 2;
      grid-column: 2 / 2;
    }
  </style>

  <form id="select_photos" action="{{ url_for('select_photos', flickr_url=flickr_url) }}" method="post">
    {{ select_photos_form.hidden_tag() }}

    {{ select_photos_form.cached_api_response_id }}

    <ul>
      {% for field in select_photos_form %}
        {% if field.id.startswith('photo_') %}
          <li>
            <label for="{{ field.id }}">
              {% set photo = field.label.text %}
              {% set thumbnail = photo.sizes|size_at(desired_size='Medium') %}
              <img src="{{ thumbnail.source }}">
              <div class="info">
                <span class="owner">by {{ photo.owner.realname or photo.owner.username }}</span>
                <span class="license">{{ photo.license.label }}</span>
                {{ field }}
              </div>
            </label>
          </li>
        {% endif %}
      {% endfor %}
    </ul>

    <p>{{ select_photos_form.submit() }}</p>
  </form>
{% endblock %}
